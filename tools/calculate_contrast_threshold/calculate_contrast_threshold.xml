<tool id="calculate_contrast_threshold" name="Calculate Contrast threshold" version="1.0.0">
    <description>from tag pileup CDT
    </description>
    <requirements>
        <requirement type="package" version="1.14.2">numpy</requirement>
        <requirement type="package" version="2.7.14">python</requirement>
    </requirements>
    <command detect_errors="exit_code">
        <![CDATA[
      python '$__tool_directory__/calculate_contrast_threshold.py' -i '$input_file'

      ## Setting the quantile values properly.
      #if str($quantile_type.quantile_type_selector) == "b_option":
        -q '${quantile_type.quantile}'
        -m '${quantile_type.min_contrast}'
      #else if str($quantile_type.quantile_type_selector) == "t_option":
        -t '${quantile_type.quantile2}'
      #end if

      -d '$header' -s '$start_col' -r '$row_num' -l '$col_num'
    ]]>
    </command>

    <inputs>
        <param name="input_file" argument="-i" type="data" format="txt" label="Pileup Data Matrix "/>
        <param name="header" argument="-d" type="text" value="T" label="Header (T/F)" help="T: First line is header; F: Header is absent"/>
        <param name="start_col" argument="-s" type="integer" value="2" label="Start Column"/>
        <param name="col_num" argument="-l" type="integer" value="300" label="Column Number" help="This would be the width of the plot you will be generating"/>
        <param name="row_num" argument="-r" type="integer" value="600" label="Row Number" help="This would be the height of the plot you will be generating"/>

        <conditional name="quantile_type">
            <param name="quantile_type_selector" type="select" display="radio" label="Choose the Contrast paramter">
                <option value="b_option" selected="true">- b</option>
                <option value="t_option">- t
                </option>
            </param>

            <when value="b_option">
                <param name="quantile" argument="-b" type="float" value="95" label="Quantile" help="Enter your quantile value above. can take values between (1 to 100)"/>
                <param name="min_contrast" type="float" value="0" label="Minimum upper limit after Quantile calculation" help="set contrast to above value, if calculated quantile is less than or equal to above value. can take real values (>= 0)" argument="-m"/>
            </when>

            <when value="t_option">
                <param name="quantile2" argument="-t" type="float" value="0.0" label="Absolute tag threshold" help="Enter your custom tag threshold value above. can take real values (>= 0)"/>
            </when>
        </conditional>

    </inputs>

    <outputs>
        <data name="threshold_output" format="txt" from_work_dir="calcThreshold.txt"/>
    </outputs>

    <tests>
        <test>
            <param name="input_file" value="sample.tabular"/>
            <param name="header" value="T"/>
            <param name="start_col" value="2"/>
            <param name="col_num" value="300"/>
            <param name="row_num" value="600"/>
            <conditional name="quantile_type">
                <param name="quantile_type_selector" value="b_option"/>
                <param name="quantile" value="95"/>
                <param name="min_contrast" value="5"/>
            </conditional>
            <output name="threshold_output" file="calcThreshold_b.txt" />
        </test>
        <test>
            <param name="input_file" value="sample.tabular"/>
            <param name="header" value="T"/>
            <param name="start_col" value="2"/>
            <param name="col_num" value="300"/>
            <param name="row_num" value="600"/>
            <conditional name="quantile_type">
                <param name="quantile_type_selector" value="t_option"/>
                <param name="quantile2" value="10.0"/>
            </conditional>
            <output name="threshold_output" file="calcThreshold_t.txt" />
        </test>
    </tests>

    <help>
        <![CDATA[

**What it does**

----

Calculates a contrast threshold from the CDT file generated by ``tag_pileup_frequency``. The calculated values are then used to set a uniform contrast for all the heatmaps generated downstream.
    ]]>
    </help>

    <citations>
        <citation type="bibtex">
            @unpublished{None,
            author = {Kuntala, Prashant Kumar and Lai, William KM },
            title = {None},
            year = {None},
            eprint = {None},
            url = {http://www.pughlab.psu.edu/}
        }</citation>
    </citations>

</tool>
