<tool id="calculate_threshold" name="Calculate Contrast threshold" version="1.0.0">
    <description>from tag pileup CDT
    </description>
    <macros></macros>
    <requirements>
        <requirement type="package" version="1.14.2">numpy</requirement>
        <requirement type="package" version="2.7.14">python</requirement>
    </requirements>
    <command>
        <![CDATA[
      python $__tool_directory__/calculateThreshold.py -i '$input_file'

      ## Setting the quantile values properly.
      #if str($quantile_type.quantile_type_selector) == "b_option":
        -q '${quantile_type.quantile}'
      #else if str($quantile_type.quantile_type_selector) == "t_option":
        -t '${quantile_type.quantile2}'
      #end if

      -d '$header' -s '$start_col' -r '$row_num' -l '$col_num'
    ]]>
    </command>

    <inputs>
        <param name="input_file" type="data" format="txt" label="CDT file to Plot"/>
        <param name="header" type="text" value="T" label="Header T/F"/>
        <param name="start_col" type="integer" value="2" label="Start Column"/>
        <param name="col_num" type="integer" value="300" label="Column Number after compress"/>
        <param name="row_num" type="integer" value="600" label="Row Number after compress"/>

        <conditional name="quantile_type">
            <param name="quantile_type_selector" type="select" display="radio" label="Choose the Contrast paramter">
                <option value="b_option" selected="true">- b</option>
                <option value="t_option">-t
                </option>
            </param>

            <when value="b_option">
                <param name="quantile" type="float" value="95" label="Quantile" help="Enter your quantile value above. can take values between (1 to 100)"/>
            </when>

            <when value="t_option">
                <param name="quantile2" type="float" value="0.0" label="Absolute tag threshold" help="Enter your custom tag threshold value above. can take values (0 to infinity)"/>
            </when>
        </conditional>

    </inputs>

    <outputs>
        <data name="out_file" format="txt" from_work_dir="calcThreshold.txt"/>
    </outputs>

    <tests>
        <test>
            <param name="input_file" value="sample.tabular"/>
            <param name="header" value="T"/>
            <param name="start_col" value="2"/>
            <param name="col_num" value="500"/>
            <param name="row_num" value="300"/>
            <conditional name="quantile_type">
                <param name="quantile_type_selector" value="b_option"/>
                <param name="quantile" value="95"/>
            </conditional>
            <output name="out_file" file="calcThreshold_b.txt" />
        </test>
        <test>
            <param name="input_file" value="sample.tabular"/>
            <param name="header" value="T"/>
            <param name="start_col" value="2"/>
            <param name="col_num" value="500"/>
            <param name="row_num" value="300"/>
            <conditional name="quantile_type">
                <param name="quantile_type_selector" value="t_option"/>
                <param name="quantile2" value="10.0"/>
            </conditional>
            <output name="out_file" file="calcThreshold_t.txt" />
        </test>
    </tests>

    <help>

**What it does**

----

Calculates the contrast threshold from the CDT file generated by ``tag_pileup_frequency`` tool. The calculated values can then used to set the contrast while heatmaps for the pile up data.

    </help>

    <citations>
        <citation type="bibtex">
            @unpublished{None,
            author = {Lai, William and Kuntala,Prashant Kumar},
            title = {None},
            year = {None},
            eprint = {None},
            url = {http://www.pughlab.psu.edu/}
        }</citation>
    </citations>

</tool>
