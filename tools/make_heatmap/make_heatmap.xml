<tool id="make_heatmap" name="Create Heatmap" version="1.0.0">
    <description>from tagPileUp data and thresholdFile</description>
    <requirements>
        <requirement type="package" version="1.14.2">numpy</requirement>
        <requirement type="package" version="2.1.0">matplotlib</requirement>
        <requirement type="package" version="2.7.14">python</requirement>
    </requirements>
    <command detect_errors="exit_code">
        <![CDATA[
      python '$__tool_directory__/make_heatmap.py' '$inputTabular' '$thresholdFile' '$colors' '$rows' '$columns' '$ticks' '$dpi' '$xlabel' '$heatmap_title'

      #if str($gen_color_bar) == "true":
       '1'
      #else:
        '0'
      #end if

      CDT_Heatmap.png
    ]]>
    </command>

    <inputs>
        <param name="inputTabular" type="data" format="tabular" label="Pileup Data Matrix to Plot"/>
        <param name="thresholdFile" type="data" format="txt" label="Threshold file"/>
        <param name="colors" type="text" value="0,0,0" label="Plot color" help=" enter RGB values separated by comma, example: 192,66,54"/>
        <param name="rows" type="integer" value="700" label="Height of the heatmap. "/>
        <param name="columns" type="integer" value="300" label="Width of the heatmap."/>
        <param name="ticks" type="text" value="500" label="Ticks for the x-axis"/>
        <param name="dpi" type="text" value="100" label=" Heatmap DPI (Dots per inch)" help=" default: 100, max: 300 (general publication dpi)"/>
        <param name="xlabel" type="text" value="Distance from midpoint in bp" label="Label under x-axis for the plot" help=""/>
        <param name="heatmap_title" type="text" value="All Features" label="Title for the Heatmap"/>
        <param name="gen_color_bar" type="boolean" truevalue="true" falsevalue="false" checked="true" label="Generate Color bar"/>

    </inputs>

    <outputs>
        <data name="heatmap_output" format="png" from_work_dir="CDT_Heatmap.png" />
        <data name="heatmap_colorbar" format="png" from_work_dir="colorbar.png">
            <filter>gen_color_bar</filter>
        </data>
    </outputs>

    <tests>
        <test>
            <param name="inputTabular" value="sample.tabular" ftype="tabular"/>
            <param name="thresholdFile" value="threshold_heatmap.txt" ftype="txt"/>
            <param name="colors" value="0,0,0"/>
            <param name="rows" value="700"/>
            <param name="columns" value="300"/>
            <param name="ticks" value="500"/>
            <param name="dpi" value="100"/>
            <param name="xlabel" value="Distance from midpoint in bp"/>
            <param name="heatmap_title" value="All Features"/>
            <param name="gen_color_bar" value="true"/>

            <output name="heatmap_output" file="makeHeatmap_output.png" ftype="png" compare="sim_size"/>
            <output name="heatmap_colorbar" file="colorbar.png" ftype="png" compare="sim_size"/>
        </test>
        <test>
            <param name="inputTabular" value="sample.tabular" ftype="tabular"/>
            <param name="thresholdFile" value="threshold_heatmap.txt" ftype="txt"/>
            <param name="colors" value="0,0,0"/>
            <param name="rows" value="700"/>
            <param name="columns" value="300"/>
            <param name="ticks" value="500"/>
            <param name="dpi" value="100"/>
            <param name="xlabel" value="Distance from midpoint in bp"/>
            <param name="heatmap_title" value="All Features"/>
            <param name="gen_color_bar" value="false"/>

            <output name="heatmap_output" file="makeHeatmap_output.png" ftype="png" compare="sim_size"/>
        </test>
    </tests>

    <help>
        <![CDATA[
        **What it does**

        Creates a heatmap from Pileup Data Matrix generated by ``tag_pileup_frequency`` and thresholdFile generated by ``calcThreshold``.
        ]]>
    </help>

    <citations>
        <citation type="bibtex">
            @unpublished{None, author = {Kuntala,Prashant Kumar and Lai, William KM }, title = {None}, year = {None}, eprint = {None}, url = {http://www.pughlab.psu.edu/} }
        </citation>
    </citations>

</tool>
